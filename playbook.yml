---
# - hosts: localhost
#   connection: local
#   tasks:
#     - name: Write hostname to file
#       copy:
#         content: "{{ ansible_hostname }}"
#         dest: "/tmp/current_hostname_play_1.txt"
#     - name: Capture all vars
#       set_fact:
#         all_vars: "{{ hostvars[inventory_hostname] }}"
#     - name: Write all vars to file
#       copy:
#         content: "{{ all_vars | to_nice_yaml }}"
#         dest: "/tmp/printed_vars_step_1.yml"
#     - ansible.builtin.add_host:
#         name: "{{ target_host_fqdn }}"
#         groups: group1
#     - name: Capture all vars again after group has been added
#       set_fact:
#         all_vars: "{{ hostvars[inventory_hostname] }}"
#     - name: Print all vars to file again after host was added
#       copy:
#         content: "{{ all_vars | to_nice_yaml }}"
#         dest: "/tmp/printed_vars_step_2.yml"

- hosts: all
  # connection: ssh
  gather_facts: no
  # vars:
  #   ansible_user: "{{ vm_root_user }}"
  #   ansible_ssh_pass: "{{ vm_root_password }}"
  #   ansible_ssh_extra_args: "-o StrictHostKeyChecking=no"
  tasks:
    - name: Write hostname to file
      copy:
        content: "{{ ansible_hostname }}"
        dest: "/tmp/current_hostname_play_2.txt"
    - name: Capture all vars again on remote host
      set_fact:
        all_vars: "{{ hostvars[inventory_hostname] }}"
    - name: Print vars to file on remote host
      copy:
        content: "{{ all_vars | to_nice_yaml }}"
        dest: "/tmp/printed_vars_step_3.yml"
    - name: Save test message to a file
      copy:
        content: "{{ message }}"
        dest: "/tmp/test.txt"
